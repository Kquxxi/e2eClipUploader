{# templates/raport_fragment.html #}
<div id="twitch-report-root">
<!-- Panel statystyk -->
<div id="stats-panel" class="stats-panel">
  <p>Łącznie klipów: <strong><span id="stats-total">{{ stats.total_clips }}</span></strong></p>
  <p>Top 3 kategorie: <strong><span id="stats-categories">
    {% for cat, cnt in stats.top_categories %}
      {{ cat }} ({{ cnt }}){% if not loop.last %}, {% endif %}
    {% endfor %}
  </span></strong></p>
  <p>Top 3 streamerzy: <strong><span id="stats-streamers">
    {% for st, cnt in stats.top_streamers %}
      {{ st }} ({{ cnt }}){% if not loop.last %}, {% endif %}
    {% endfor %}
  </span></strong></p>
</div>

<div class="filter-panel">
  <div class="dropdown" id="dd-streamers">
    <button type="button">Streamerzy ▼</button>
    <div class="dropdown-list">
      {% set streamers = clips | map(attribute='broadcaster') | unique | sort %}
      {% for s in streamers %}
        <label>
          <input type="checkbox" class="filter-streamer" value="{{ s }}" checked>
          {{ s }}
        </label>
      {% endfor %}
      <button class="btn-apply" id="apply-streamers">Zastosuj</button>
    </div>
  </div>

  <div class="dropdown" id="dd-categories">
    <button type="button">Kategorie ▼</button>
    <div class="dropdown-list">
      {% set cats = clips | map(attribute='category') | unique | sort %}
      {% for c in cats %}
        <label>
          <input type="checkbox" class="filter-category" value="{{ c }}" checked>
          {{ c }}
        </label>
      {% endfor %}
      <button class="btn-apply" id="apply-categories">Zastosuj</button>
    </div>
  </div>
</div>

<!-- Lokalne przyciski edytora usunięte – używamy globalnego paska w index.html -->
<!-- Lokalny panel zapisanych usunięty – używamy globalnego overlayu w index.html -->

<!-- Globalne przyciski i panel zapisanych są renderowane w index.html -->
<table id="report-table">
  <thead>
    <tr>
      <th>Akcja</th>
      <th>Streamer</th>
      <th>Tytuł</th>
      <th>Wyświetlenia</th>
      <th>Czas</th>
      <th>Kategoria</th>
    </tr>
  </thead>
  <tbody>
  {% for c in clips %}
    <tr data-streamer="{{ c.broadcaster }}" data-category="{{ c.category }}" class="{% if c.broadcaster|lower in highlighted_streamers %}featured-streamer{% endif %}">
      <td>
        <button class="btn-icon icon-toggle add-to-editor" title="Dodaj/Usuń" data-url="{{ c.url }}" data-broadcaster="{{ c.broadcaster }}" data-title="{{ c.title }}">➕</button>
      </td>
      <td>
        {{ c.broadcaster }}
        {% if c.broadcaster|lower in highlighted_streamers %}
          <span class="badge-featured" title="Wyróżniony">⭐</span>
        {% endif %}
      </td>
      <td>
        <a href="{{ c.url }}" target="_blank" title="{{ c.title }}">
          {%- set t = c.title -%}
          {{ t[:40] }}{{ '…' if t|length > 40 else '' }}
        </a>
      </td>
      <td>{{ c.views }}</td>
      <td>{{ c.relative_time }}</td>
      <td>
        <span title="{{ c.category }}">
          {%- set k = c.category -%}
          {{ k[:25] }}{{ '…' if k|length > 25 else '' }}
        </span>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
</div>
